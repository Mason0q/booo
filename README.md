Практическая работа 
«Разработка формы входа пользователей в информационную систему»
Информационная система (ИС) организации предоставляет пользователям возможность решать различные задачи, соответствующие его производственным обязанностям. 
 
Перед началом работы пользователя с системой обычно выполняется проверка то-го, что именно конкретный пользователь подключается к системе (аутентификация пользователя, аналогия проверки паспорта). Для этого используются данные из БД, которую вы создали в предыдущем задании с двумя таблицами Users и Roles.
Аутентификация выполняется путем проверки имени пользователя в системе (ло-гина) и заданного им пароля. 
•	Если данные не совпадают, то система не предоставляет пользователю возмож-ность выполнения работы.
•	Если эти данные совпадают, то система знает, с кем она работает и показывает ему требуемые формы.
Обычно доступ ко всем функциям ИС реализуется с помощью графического интерфейса в виде форм.
Работа с SQL базой данных из приложения на языке C# используется технология Entity Framework (EF) и набор специальных элементов управления для отображения информации пользователю и ввода его данных.
Для работы с БД с EF требуется вначале добавить в проект модель EF, которая содержит: 
1.	класс контекста производный от класса DBContext, который включает набор кол-лекций DbSet<класс таблицы>, которые будут содержать объекты классов сущно-стей.
2.	набор классов сущностей, каждый из которых соответствует таблице, включае-мой в модель.
Для создания и добавления в проект приложения модели Entity Framework нужно выполнить команду Проект –> Добавить новый элемент –> Модель ADO.Net EDM.
1) Создание проекта Visual Studio и добавления в него модели Entity Framework
1.	Открываем программу Visual Studio и создаем в ней проект по шаблону «Приложения Windows Forms (.Net Framework)».
2.	Добавим в проект папку:
 
3.	Зададим папке имя «ModelEF»:




4.	Добавим в папку ModelEF модель Entity Framework с именем Model1 для используемой базы данных и таблиц Roles и Users. 
 

В модели будут коллекции с именем Roles и Users и классы сущностей с таким же именами.
 

3) Создание основной формы программы
5.	Заменим имя формы Form1 на MainForm. 

 

6.	Зададим в окне «Свойства» форме MainForm название – «Вход в информационную систему» (свойство Text). 

7.	Разместим на форме MainForm следующие элементы управления:
 
Зададим элементам управления осмысленные имена (свойства Name).

8.	Создаем в форме MainForm обработчик события Click для кнопки ExitBtn (Закончить работу):
private void ExitBtn_Click(object sender, EventArgs e)
{
   // закрываем начальную форму и заканчиваем работу программы
   this.Close(); 
   // или можно по другому
   // Application.Exit();
}

9.	В информационной системе будут пользователи следующих типов (ролей):
	Директор;
	Менеджер;
	Администратор ИС.
Для пользователей, играющих разные роли, информационная система предоставляет различные возможности.
4) Создание форм для разных типов пользователей
10.	Создаем форму Директора – DirectorForm и разместим на ней следующие элементы управления:
 

11.	Создаем форму Менеджера – ManagerForm и разместим на ней следующие элементы управления:

 

12.	Создаем форму Администратора – AdminForm и разместим на ней следующие элементы управления:

 


13.	Создадим в классе Program статическую переменную

// статическое открытое поле для хранения подключенного пользователя
public static Users USER = null;

// статическое открытое поле для объекта модели 
// для использования нужно ссылаться: Program.db
public static Model1 db = new Model1();

5) Создание метода проверки учетных данных пользователя
14.	Создаем в MainForm метод-обработчик события Click для кнопки EnterBtn (Войти).
Не пишем данный метод вручную. Создаем его с помощью двойного щелчка мыши на кнопку EnterBtn и затем кодируем!!!
// открытое поле для предыдущей формы
public Form prevFORM = null;

// метод проверки введенных данных и показа нужной формы
private void EnterBtn_Click(object sender, EventArgs e)
{
   // проверяем, что в текстовые поля введены данные
   if(LoginTxt.Text == "" || PswTxt.Text == "")
   {
      MessageBox.Show("Нужно задать логин и пароль!");
      return;
   }

   // ищем в коллекции с именем Users, объект типа Users 
   // с введенным логином – первичным ключем
   Users usr = Program.db.Users.Find(LoginTxt.Text);

   // если такой пользователь есть (не равен null) 
   // и его пароль совпадает с введенным значением
   if((usr != null) && (usr.psw == PswTxt.Text))
   {
      // сохраняем данные пользователя в статической переменной
      // для использования данных пользователя в других формах
      Program.USER = usr;

// проверяем роль пользователя
      // если роль = «Директор», то вызываем форму Директора
      if(usr.role == 1)
      {
// создаем форму директора
DirectorForm frm = new DirectorForm();

// сохраняем в форме куда возвращаться
frm.prevFORM = this;
         
// показываем форму директора
         frm.Show();
         
//  форму подключения скрываем (но не закрываем!)
         this.Hide();
      }
// если роль = «Менеджер», то вызываем форму Менеджера
      else if(usr.role == 2)
      {
         // создаем форму менеджера
         ManagerForm frm = new ManagerForm();
         
// сохраняем в форме куда возвращаться
frm.prevFORM = this;

         // показываем форму менеджера
         frm.Show();

         // начальную форму подключения скрываем (но не закрываем!)
         this.Hide();
      } 
// если роль = «Администратор», то вызываем форму Администратора
      else if(usr.role == 3)
      {
         // создаем форму администратора
         AdminForm frm = new AdminForm();
         // сохраняем в форме куда возвращаться
frm.prevFORM = this;

         // показываем форму администратора
         frm.Show();

         // начальную форму подключения скрываем (но не закрываем!)
         this.Hide();
      }          
   }
   else 
   {
      // если данные введены неправильно, то показываем сообщение
      MessageBox.Show("Пользователя с таким логином и паролем нет!");
      return;
   }
}


6) Программирование формы директора DirectorForm
15.	Создаем в ней открытое поле prevFORM и обработчик события Load: 
// открытое поле для предыдущей формы
public Form prevFORM = null;

// обработчик события Load - загрузка формы Директора
private void DirectorForm_Load(object sender, EventArgs e)
{
   HelloLbl.Text = "Добрый день, " + Program.USER.FIO + " !";
}

16.	Создаем в классе DirectorForm (форма Директора) обработчик события Click для кнопки ExitBtn (Выйти): 
// закрытие формы Директора и показ формы входа
private void ExitBtn_Click(object sender, EventArgs e)
{
// текущую форму закрываем
this.Close(); 
// показываем скрытую форму MainForm
if(prevFORM != null) prevFORM.Show();   
}

6) Программирование формы менеджера ManagerForm 
17.	Создаем в ней открытое поле prevFORM и обработчик события Load: 
// поле для предыдущей формы
public Form prevFORM = null;

// обработчик события Load - загрузка формы Менеджера
private void ManagerForm_Load(object sender, EventArgs e)
{
   HelloLbl.Text = "Добрый день, " + Program.USER.FIO + " !";
}

18.	Создаем в классе ManagerForm(форма Менеджера) обработчик события Click для кнопки ExitBtn (Выйти): 
// закрытие формы Менеджера и показ формы входа
private void ExitBtn_Click(object sender, EventArgs e)
{
  // текущую форму закрываем
this.Close(); 
// показываем скрытую форму MainForm
if(prevFORM != null) prevFORM.Show();   
}

6) Программирование формы администратора AdminForm 
19.	Создаем в ней открытое поле prevFORM и обработчик события Load: 
// открытое поле для предыдущей формы
public Form prevFORM = null;

// обработчик события Load - загрузка формы AdminForm
private void AdminForm_Load(object sender, EventArgs e)
{
   HelloLbl.Text = "Добрый день, " + Program.USER.FIO + " !";
}
 
20.	Создаем в классе AdminForm (форма Администратора) обработчик события Click для кнопки ExitBtn (Выйти): 
// закрытие формы Менеджера и показ формы входа
private void ExitBtn_Click(object sender, EventArgs e)
{
  // текущую форму закрываем
  this.Close(); 
// показываем скрытую форму MainForm
if(prevFORM != null) prevFORM.Show();     
}

Также можно создать и формы для других ролей пользователей. Например: Бухгалтер, Заказчик, НачальникЦеха и т.п.

Задание на выполнение лабораторной работы:

1.	У вас уже должна быть создана БД с таблицами Users и Roles.

2.	Создать в Visual Studio проект по шаблону «Приложение Windows Forms (.NetFramework)».

3.	Добавляем в проект модель Entity Framework (смотри файл описанием, как это сделать).

4.	Создать формы и пишем код обработчиков событий.

5.	Выполняем сборку проекта и отладку программы!

6.	Составить отчет в формате Word и загрузить в Google Class

a.	Скриншот созданной БД.
b.	Код программы (можно скриншоты).
c.	Скриншоты результатов работы программы.

7.	Загрузить отчет в Google Class
